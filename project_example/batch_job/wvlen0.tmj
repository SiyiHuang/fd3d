#!/bin/tcsh
# The following are embedded QSUB options. The syntax is #PBS (the # does
# _not_  denote that the lines are commented out so do not remove).
#
# walltime : maximum wall clock time (hh:mm:ss)
#PBS -l walltime=00:20:00
#
# nodes: number of 8-core nodes
#   ppn: how many cores per node to use (1 through 8)
#       (you are always charged for the entire node)
#PBS -l nodes=32:ppn=8
#
# export all my environment variables to the job
#PBS -V
#
###PBS -m be
#
###PBS -M wsshin@stanford.edu
#
# End of embedded QSUB options
#
# set echo               # echo commands before execution; use for debugging
#

echo | mail -s "Abe: trunk fd3d job started ($PBS_JOBID)" wsshin@stanford.edu

cd ${FD3D_ROOT}/bin

mvapich2-start-mpd
setenv NP `wc -l ${PBS_NODEFILE} | cut -d'/' -f1`

setenv MV2_SRQ_SIZE 4000
mpirun -np ${NP} ./fd3d -i bend50nm$wvlen$

# The mpirun syntax above will assign ranks to nodes in round-robin fashion.
# To get ranks *packed* into nodes, use this syntax:
#
#  mpirun  -machinefile ${PBS_NODEFILE} -np ${NP} a.out

mpdallexit

cd ${TRUNK}/out
./dtof bend50nm$wvlen$

echo | mail -s "Abe: trunk fd3d job finished ($PBS_JOBID)" wsshin@stanford.edu
